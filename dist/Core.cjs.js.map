{"version":3,"file":"Core.cjs.js","sources":["../src/Application/Application.js","../src/Engine/Viewers/Viewer.js","../src/Engine/Viewers/Viewer2d.js","../src/Engine/CameraManager.js","../src/Engine/Project.js","../src/Engine/Scene.js","../src/Engine/Engine.js","../src/Engine/EntityManager.js","../src/Engine/Renderers/CanvasRenderer.js"],"sourcesContent":["import { Engine } from \"@/Bundles/Core\";\r\n\r\nclass Application {\r\n  static activeProject;\r\n  static engine;\r\n\r\n  static start() {\r\n    this.engine = new Engine();\r\n\r\n    return new Promise((resolve) => {\r\n      resolve(true);\r\n    });\r\n  }\r\n\r\n  static loadProject(project, options) {\r\n    this.activeProject = new project(options);\r\n    this.engine.setProject(this.activeProject);\r\n  }\r\n}\r\n\r\nexport default Application;\r\n","import { ImplementError } from \"@/Bundles/Errors\";\r\n\r\nclass Viewer {\r\n  options;\r\n\r\n  refresh() {}\r\n  render() {\r\n    throw new ImplementError(\"render\", \"Viewer\");\r\n  }\r\n}\r\n\r\nexport default Viewer;\r\n","import { Vector2, CanvasRenderer } from \"@/Bundles/Core\";\r\n\r\nclass Viewer2d {\r\n  options;\r\n  node;\r\n  renderer;\r\n  size = new Vector2();\r\n  origin = new Vector2();\r\n\r\n  constructor(node, options) {\r\n    this.node = node;\r\n    this.options = { ...this.options, ...options };\r\n\r\n    this.renderer = new CanvasRenderer(this.options);\r\n    this.size = this.options.size;\r\n    this.render();\r\n  }\r\n\r\n  get ctx() {\r\n    return this.renderer.ctx;\r\n  }\r\n\r\n  center() {\r\n    this.origin = this.size.clone().divide(2);\r\n    this.ctx.translate(this.origin.x, this.origin.y);\r\n  }\r\n\r\n  render() {\r\n    this.ctx.clearRect(0, 0, this.size.x, this.size.y);\r\n    this.node.appendChild(this.renderer.domElement);\r\n  }\r\n\r\n  refresh() {\r\n    // this.size.x = window.innerWidth;\r\n    // this.size.y = window.innerHeight;\r\n    // this.renderer.domElement.width = this.size.x;\r\n    // this.renderer.domElement.height = this.size.y;\r\n    this.ctx.clearRect(\r\n      -this.size.x / 2,\r\n      -this.size.y / 2,\r\n      this.size.x,\r\n      this.size.y\r\n    );\r\n  }\r\n}\r\n\r\nexport default Viewer2d;\r\n","class CameraManager {\r\n    #activeCamera = null\r\n    cameras = {}\r\n\r\n    constructor(scene, renderer) {\r\n        this.renderer = renderer;\r\n        this.scene = scene;\r\n    }\r\n\r\n    get activeCamera() {\r\n        return this.cameras[this.#activeCamera]\r\n    }\r\n\r\n    activateCamera(name) {\r\n        this.#activeCamera = name\r\n    }\r\n\r\n    addCamera(name, camera) {\r\n        this.cameras[name] = camera\r\n    }\r\n}\r\n\r\nexport default CameraManager","import { Observer } from \"@/Bundles/Core\";\r\nimport { ImplementError } from \"@/Bundles/Errors.js\";\r\n\r\nconst Events = {\r\n  INITIALIZED: \"INITIALIZED\",\r\n};\r\n\r\nclass Project {\r\n  scenes = [];\r\n  options = {\r\n    name: \"Skava - Snake\",\r\n    mountOn: \"#app\",\r\n    isDev: false,\r\n  };\r\n  loopCallback;\r\n  observer;\r\n\r\n  constructor(options) {\r\n    this.options = { ...this.options, ...options };\r\n    this.observer = new Observer(Object.keys(Events));\r\n    setTimeout(this.setup.bind(this), 0);\r\n  }\r\n\r\n  addScene(scene, options) {\r\n    scene.createViewer(this.options.mountOn);\r\n    Promise.resolve(scene.setup()).then(() => {\r\n      scene.setupFinished = true;\r\n    });\r\n    this.scenes.push(scene);\r\n  }\r\n\r\n  getScene(sceneName) {\r\n    return this.scenes.find((scene) => scene.name === sceneName);\r\n  }\r\n\r\n  setup() {\r\n    throw new ImplementError(\"setup\", \"Project\");\r\n  }\r\n\r\n  update(deltaTime, currentTime) {\r\n    this.scenes.forEach((scene) => scene.update(deltaTime, currentTime));\r\n    this.loop(deltaTime, currentTime);\r\n  }\r\n  loop(deltaTime, currentTime) {}\r\n}\r\n\r\nexport default Project;\r\n","import { EntityManager, Viewer2d, Vector2 } from \"@/Bundles/Core\";\r\n\r\nclass Scene {\r\n  setupFinished = false;\r\n\r\n  name = \"\";\r\n  entityManager = null;\r\n  viewer;\r\n  #loopHasBeenWarned = false;\r\n\r\n  constructor(name) {\r\n    this.name = name;\r\n    this.entityManager = new EntityManager(this);\r\n  }\r\n\r\n  createViewer(mountOn, options) {\r\n    let app =\r\n      mountOn instanceof HTMLElement\r\n        ? mountOn\r\n        : document.querySelector(mountOn);\r\n    this.viewer = new Viewer2d(app, {\r\n      size: new Vector2(window.innerWidth, window.innerHeight),\r\n      ...options,\r\n    });\r\n  }\r\n\r\n  add(entity, executeSetup) {\r\n    this.entityManager.add(entity, executeSetup);\r\n  }\r\n\r\n  remove(entityToDelete) {\r\n    this.entityManager.delete(entityToDelete);\r\n  }\r\n\r\n  update(deltaTime, currentTime) {\r\n    if (this.setupFinished) {\r\n      this.viewer?.refresh(deltaTime);\r\n      this.loop(deltaTime, currentTime);\r\n      this.entityManager.update(deltaTime, currentTime);\r\n    }\r\n  }\r\n\r\n  setup() {\r\n    console.warn(\r\n      `\"setup()\" method is not implemented on the scene ${this.constructor.name}`\r\n    );\r\n  }\r\n  loop(deltaTime, currentTime) {\r\n    if (!this.#loopHasBeenWarned) {\r\n      this.#loopHasBeenWarned = true;\r\n      console.warn(\r\n        `\"loop()\" method is not implemented on the scene ${this.constructor.name}`\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport default Scene;\r\n","import { Observer } from \"@/Bundles/Core\";\r\nimport { Timer } from \"@/Bundles/Utils\";\r\n\r\nconst Events = {\r\n  INITIALIZED: \"INITIALIZED\",\r\n};\r\n\r\nclass Engine {\r\n  project;\r\n  observer;\r\n  lastUpdate = 0;\r\n\r\n  fpsMeter;\r\n\r\n  constructor() {\r\n    this.observer = new Observer(Events);\r\n    this.observer.$on(Events.INITIALIZED, this.loop.bind(this));\r\n    this.timer = new Timer();\r\n\r\n    this.fpsMeter = document.createElement(\"div\");\r\n    this.fpsMeter.classList.add(\"fps-meter\");\r\n    this.fpsMeter.setAttribute(\"last-update\", \"0\");\r\n    document.body.appendChild(this.fpsMeter);\r\n  }\r\n\r\n  setProject(project) {\r\n    this.project = project;\r\n    this.observer.$emit(Events.INITIALIZED);\r\n  }\r\n\r\n  i = 0;\r\n\r\n  async loop(currentTime = 0) {\r\n    let deltaTimeFps =\r\n      (currentTime - parseFloat(this.fpsMeter.getAttribute(\"last-update\"))) /\r\n      1000;\r\n    let deltaTime = (currentTime - this.lastUpdate) / 1000;\r\n\r\n    if (deltaTimeFps > 0.5) {\r\n      this.fpsMeter.innerText = (1 / deltaTime).toFixed();\r\n      this.fpsMeter.setAttribute(\"last-update\", currentTime + \"\");\r\n    }\r\n    if (this.project) {\r\n      this.project.update(deltaTime, currentTime);\r\n    }\r\n    // await new Promise((r) => setTimeout(r, 1000));\r\n    this.lastUpdate = currentTime;\r\n    window.requestAnimationFrame(this.loop.bind(this));\r\n  }\r\n}\r\n\r\nexport default Engine;\r\n","import { UndefinedError } from \"@/Bundles/Errors\";\r\nimport { Observer, Entity } from \"@/Bundles/Core\";\r\n\r\nclass EntityManager {\r\n  static EVENTS = Object.freeze({\r\n    ENTITY_ADDED: \"ENTITY_ADDED\",\r\n    ENTITY_DELETED: \"ENTITY_DELETED\",\r\n  });\r\n\r\n  observer = new Observer(EntityManager.EVENTS);\r\n\r\n  entities = [];\r\n  scene = null;\r\n\r\n  constructor(scene) {\r\n    if (!scene) {\r\n      throw new UndefinedError(\"scene\");\r\n    }\r\n    this.scene = scene;\r\n  }\r\n\r\n  delete(entityToDelete) {\r\n    let foundIndex = this.entities.findIndex((entity) => {\r\n      if (typeof entityToDelete === \"string\") {\r\n        return entity.uuid === entityToDelete;\r\n      } else if (entityToDelete instanceof Entity) {\r\n        return entity === entityToDelete;\r\n      }\r\n      return false;\r\n    });\r\n\r\n    if (foundIndex !== -1) {\r\n      let entityFound = this.entities[foundIndex];\r\n\r\n      this.observer.$emit(EntityManager.EVENTS.ENTITY_DELETED, entityFound);\r\n\r\n      for (let i = entityFound.components.length - 1; i >= 0; i--) {\r\n        entityFound.components.splice(i, 1);\r\n      }\r\n\r\n      delete this.entities[foundIndex];\r\n      this.entities.splice(foundIndex, 1);\r\n    }\r\n  }\r\n\r\n  add(entity, executeSetup = true) {\r\n    entity.scene = this.scene;\r\n    if (entity.children) {\r\n      entity.children.forEach((child) => this.add(child));\r\n    }\r\n    if (executeSetup) {\r\n      Promise.resolve(entity.setup()).then(() => {\r\n        entity.observer.$emit(\"SETUP_FINISHED\");\r\n      });\r\n    }\r\n    this.entities.push(entity);\r\n\r\n    this.observer.$emit(EntityManager.EVENTS.ENTITY_ADDED, entity);\r\n  }\r\n\r\n  update(deltaTime, currentTime) {\r\n    this.entities.forEach((entity) => entity.update(deltaTime, currentTime));\r\n  }\r\n}\r\n\r\nexport default EntityManager;\r\n","class CanvasRenderer {\r\n  options;\r\n  domElement;\r\n\r\n  constructor(options) {\r\n    this.options = options;\r\n    this.createDomElement();\r\n  }\r\n\r\n  get ctx() {\r\n    return this.domElement?.getContext(\"2d\");\r\n  }\r\n\r\n  createDomElement() {\r\n    this.domElement = document.createElement(\"canvas\");\r\n    this.domElement.width = this.options.size.x;\r\n    this.domElement.height = this.options.size.y;\r\n  }\r\n}\r\n\r\nexport default CanvasRenderer;\r\n"],"names":["ImplementError","Vector2","Events","Observer","Timer","UndefinedError","Entity"],"mappings":"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"}